"use strict";(self.webpackChunkfandaqapp=self.webpackChunkfandaqapp||[]).push([[37255],{37255:(q,_,r)=>{r.d(_,{M:()=>O,x:()=>D});var c=r(88762),e=r(19212);let u=(()=>{class s{constructor(t){this.restService=t,this.apiName="AbpPermissionManagement",this.get=(n,i)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:n,providerKey:i}},{apiName:this.apiName}),this.update=(n,i,a)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:n,providerKey:i},body:a},{apiName:this.apiName})}static#e=this.\u0275fac=function(n){return new(n||s)(e.LFG(c.vgb))};static#t=this.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var f=r(35211),b=r(22096),v=r(48180),T=r(94664),C=r(64716),x=r(99397),p=r(96814),d=r(60095),m=r(69670);const y=["selectAllInThisTabsRef"],G=["selectAllInAllTabsRef"];function A(s,o){if(1&s&&(e.TgZ(0,"h4"),e._uU(1),e.ALo(2,"abpLocalization"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.AsE(" ",e.lcZ(2,2,"AbpPermissionManagement::Permissions")," - ",t.entityDisplayName||t.data.entityDisplayName," ")}}function M(s,o){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&s){const t=e.oxw().ngIf;e.xp6(1),e.hij("(",t.assignedCount,")")}}function N(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"a",24),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.onChangeGroup(i))})("select",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.setDisabled(i.permissions))}),e.TgZ(1,"div"),e._uU(2),e.YNc(3,M,2,1,"span",1),e.qZA()()}if(2&s){const t=o.ngIf,n=e.oxw().$implicit,i=e.oxw(3);e.ekj("active",(null==i.selectedGroup?null:i.selectedGroup.name)===(null==n?null:n.name)),e.xp6(1),e.ekj("font-weight-bold",t.assignedCount),e.xp6(1),e.hij(" ",null==n?null:n.displayName," "),e.xp6(1),e.Q6J("ngIf",t.assignedCount>0)}}const P=s=>({assignedCount:s});function k(s,o){if(1&s&&(e.TgZ(0,"li",22),e.YNc(1,N,4,6,"a",23),e.qZA()),2&s){const t=o.$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",e.VKq(1,P,n.getAssignedCount(t.name)))}}function S(s,o){if(1&s&&(e.TgZ(0,"span",30),e._uU(1),e.qZA()),2&s){const t=o.$implicit;e.xp6(1),e.AsE("",t.providerName,": ",t.providerKey,"")}}function Z(s,o){if(1&s&&(e.ynx(0),e.YNc(1,S,2,2,"span",29),e.BQk()),2&s){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",t.grantedProviders)}}function I(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",25)(1,"input",26,27),e.NdJ("click",function(){const a=e.CHM(t).$implicit,l=e.MAs(2),K=e.oxw(3);return e.KtG(K.onClickCheckbox(a,l.value))}),e.qZA(),e.TgZ(3,"label",28),e._uU(4),e.YNc(5,Z,2,1,"ng-container",1),e.qZA()()}if(2&s){const t=o.$implicit,n=e.oxw(3);e.Q6J("ngStyle",t.style),e.xp6(1),e.Q6J("checked",n.getChecked(t.name))("value",n.getChecked(t.name))("disabled",n.isGrantedByOtherProviderName(t.grantedProviders)),e.uIk("id",t.name),e.xp6(2),e.uIk("for",t.name),e.xp6(1),e.hij("",t.displayName," "),e.xp6(1),e.Q6J("ngIf",!n.hideBadges)}}function F(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"input",8,9),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.selectAllTab=i)})("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onClickSelectAll())}),e.qZA(),e.TgZ(5,"label",10),e._uU(6),e.ALo(7,"abpLocalization"),e.qZA()(),e._UZ(8,"hr",11),e.TgZ(9,"div",12)(10,"ul",13),e.YNc(11,k,2,3,"li",14),e.qZA()()(),e.TgZ(12,"div",15)(13,"div",16)(14,"div",7)(15,"input",17,18),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.selectThisTab=i)})("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onClickSelectThisTab())}),e.qZA(),e.TgZ(17,"label",19),e._uU(18),e.ALo(19,"abpLocalization"),e.qZA()(),e._UZ(20,"hr",20),e.YNc(21,I,6,8,"div",21),e.qZA()()()}if(2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.selectAllTab)("disabled",t.disabledSelectAllInAllTabs),e.xp6(3),e.Oqu(e.lcZ(7,10,"AbpPermissionManagement::SelectAllInAllTabs")),e.xp6(5),e.Q6J("ngForOf",t.data.groups)("ngForTrackBy",t.trackByFn),e.xp6(4),e.Q6J("ngModel",t.selectThisTab)("disabled",t.disableSelectAllTab),e.xp6(3),e.Oqu(e.lcZ(19,12,"AbpPermissionManagement::SelectAllInThisTab")),e.xp6(3),e.Q6J("ngForOf",t.selectedGroupPermissions)("ngForTrackBy",t.trackByFn)}}function w(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"button",31),e._uU(1),e.ALo(2,"abpLocalization"),e.qZA(),e.TgZ(3,"abp-button",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"abpLocalization"),e.qZA()}2&s&&(e.xp6(1),e.hij(" ",e.lcZ(2,2,"AbpIdentity::Cancel")," "),e.xp6(3),e.Oqu(e.lcZ(5,4,"AbpIdentity::Save")))}function B(s,o){1&s&&(e.ynx(0),e.YNc(1,A,3,4,"ng-template",null,2,e.W1O)(3,F,22,14,"ng-template",null,3,e.W1O)(5,w,6,6,"ng-template",null,4,e.W1O),e.BQk())}const J=()=>({size:"lg",scrollable:!1});let O=(()=>{class s{get visible(){return this._visible}set visible(t){t!==this._visible&&(t?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0),(0,f.z)(this.selectAllInAllTabsRef.changes,this.selectAllInThisTabsRef.changes).pipe((0,v.q)(1)).subscribe(()=>{this.initModal()})}):(this.setSelectedGroup(null),this._visible=!1,this.visibleChange.emit(!1)))}constructor(t,n){this.service=t,this.configState=n,this.hideBadges=!1,this._visible=!1,this.visibleChange=new e.vpe,this.data={groups:[],entityDisplayName:""},this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.disableSelectAllTab=!1,this.disabledSelectAllInAllTabs=!1,this.modalBusy=!1,this.selectedGroupPermissions=[],this.trackByFn=(i,a)=>a.name}getChecked(t){return(this.permissions.find(n=>n.name===t)||{isGranted:!1}).isGranted}setSelectedGroup(t){if(this.selectedGroup=t,!this.selectedGroup)return void(this.selectedGroupPermissions=[]);const n=`margin-${"rtl"===document.body.dir?"right":"left"}.px`,i=(this.data.groups.find(a=>a.name===this.selectedGroup?.name)||{}).permissions||[];this.selectedGroupPermissions=i.map(a=>({...a,style:{[n]:h(i,a)},isGranted:(this.permissions.find(l=>l.name===a.name)||{}).isGranted}))}setDisabled(t){this.disableSelectAllTab=!!t.length&&t.every(n=>n.isGranted&&n.grantedProviders?.every(i=>i.providerName!==this.providerName))}isGrantedByOtherProviderName(t){return!!t.length&&t.findIndex(n=>n.providerName!==this.providerName)>-1}onClickCheckbox(t){t.isGranted&&this.isGrantedByOtherProviderName(t.grantedProviders)||(this.setSelectedGroup(this.selectedGroup),setTimeout(()=>{this.permissions=this.permissions.map(n=>t.name===n.name?{...n,isGranted:!n.isGranted}:t.name===n.parentName&&t.isGranted?{...n,isGranted:!1}:t.parentName!==n.name||t.isGranted?n:{...n,isGranted:!0}),this.updateSelectedGroupPermissions(t),this.setTabCheckboxState(),this.setGrantCheckboxState(),this.setParentClicked(t)},0))}setParentClicked(t){let i,n=0;if(t.parentName)return this.permissions.forEach(a=>{a.name===t.parentName&&(i=a)}),this.permissions.forEach(a=>{i.name===a.parentName&&a.isGranted&&n++}),void(1===n&&!i.isGranted&&(this.permissions=this.permissions.map(a=>(a.name===i.name&&(a.isGranted=!0),a))));this.permissions=this.permissions.map(a=>(a.parentName===t.name&&(a.isGranted=!1),a))}updateSelectedGroupPermissions(t){this.selectedGroupPermissions=this.selectedGroupPermissions.map(n=>(n.name===t.name&&(n.isGranted=!n.isGranted),n))}setTabCheckboxState(){const t=this.selectedGroupPermissions.filter(a=>a.grantedProviders.every(l=>l.providerName===this.providerName)),n=t.filter(a=>a.isGranted),i=document.querySelector("#select-all-in-this-tabs");n.length===t.length?(i.indeterminate=!1,this.selectThisTab=!0):0===n.length?(i.indeterminate=!1,this.selectThisTab=!1):i.indeterminate=!0}setGrantCheckboxState(){const t=this.permissions.filter(a=>a.grantedProviders.every(l=>l.providerName===this.providerName)),n=t.filter(a=>a.isGranted),i=document.querySelector("#select-all-in-all-tabs");n.length===t.length?(i.indeterminate=!1,this.selectAllTab=!0):0===n.length?(i.indeterminate=!1,this.selectAllTab=!1):i.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions.forEach(t=>{if(t.isGranted&&this.isGrantedByOtherProviderName(t.grantedProviders))return;const n=this.permissions.findIndex(i=>i.name===t.name);this.permissions=[...this.permissions.slice(0,n),{...this.permissions[n],isGranted:!this.selectThisTab},...this.permissions.slice(n+1)]}),this.setGrantCheckboxState()}onClickSelectAll(){this.permissions=this.permissions.map(t=>({...t,isGranted:this.isGrantedByOtherProviderName(t.grantedProviders)||!this.selectAllTab})),this.disableSelectAllTab||(this.selectThisTab=!this.selectAllTab,this.setTabCheckboxState()),this.onChangeGroup(this.selectedGroup)}onChangeGroup(t){this.setDisabled(t.permissions),this.setSelectedGroup(t),this.setTabCheckboxState()}submit(){const t=g(this.data.groups),n=this.permissions.filter(i=>(t.find(a=>a.name===i.name)||{}).isGranted!==i.isGranted).map(({name:i,isGranted:a})=>({name:i,isGranted:a}));n.length?(this.modalBusy=!0,this.service.update(this.providerName,this.providerKey,{permissions:n}).pipe((0,T.w)(()=>this.shouldFetchAppConfig()?this.configState.refreshAppState():(0,b.of)(null)),(0,C.x)(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1})):this.visible=!1}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.service.get(this.providerName,this.providerKey).pipe((0,x.b)(t=>{this.data=t,this.permissions=g(t.groups),this.setSelectedGroup(t.groups[0]),this.disabledSelectAllInAllTabs=this.permissions.every(n=>n.isGranted&&n.grantedProviders.every(i=>i.providerName!==this.providerName))}))}initModal(){setTimeout(()=>{this.setDisabled(this.selectedGroup?.permissions||[]),this.setTabCheckboxState(),this.setGrantCheckboxState()})}getAssignedCount(t){return this.permissions.reduce((n,i)=>i.groupName===t&&i.isGranted?n+1:n,0)}shouldFetchAppConfig(){const t=this.configState.getOne("currentUser");return"R"===this.providerName?t.roles.some(n=>n===this.providerKey):"U"===this.providerName&&t.id===this.providerKey}static#e=this.\u0275fac=function(n){return new(n||s)(e.Y36(u),e.Y36(c.XJE))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["abp-permission-management"]],viewQuery:function(n,i){if(1&n&&(e.Gf(y,5),e.Gf(G,5)),2&n){let a;e.iGM(a=e.CRH())&&(i.selectAllInThisTabsRef=a),e.iGM(a=e.CRH())&&(i.selectAllInAllTabsRef=a)}},inputs:{providerName:"providerName",providerKey:"providerKey",hideBadges:"hideBadges",entityDisplayName:"entityDisplayName",visible:"visible"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:2,vars:5,consts:[[3,"visible","busy","options","visibleChange"],[4,"ngIf"],["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"row"],[1,"col-md-4","scroll-in-modal"],[1,"form-check","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"form-check-input",3,"ngModel","disabled","ngModelChange","click"],["selectAllInAllTabsRef",""],["for","select-all-in-all-tabs",1,"form-check-label"],[1,"mt-2","mb-2"],[1,"overflow-auto"],[1,"nav","nav-pills","flex-column"],["class","nav-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-8","scroll-in-modal"],[1,"ps-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"form-check-input",3,"ngModel","disabled","ngModelChange","click"],["selectAllInThisTabsRef",""],["for","select-all-in-this-tabs",1,"form-check-label"],[1,"my-2"],["class","form-check mb-2",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nav-item"],["class","nav-link pointer",3,"active","click","select",4,"ngIf"],[1,"nav-link","pointer",3,"click","select"],[1,"form-check","mb-2",3,"ngStyle"],["type","checkbox",1,"form-check-input",3,"checked","value","disabled","click"],["permissionCheckbox",""],[1,"form-check-label"],["class","badge bg-light text-dark",4,"ngFor","ngForOf"],[1,"badge","bg-light","text-dark"],["type","button","abpClose","",1,"btn","btn-secondary"],["iconClass","fa fa-check",3,"click"]],template:function(n,i){1&n&&(e.TgZ(0,"abp-modal",0),e.NdJ("visibleChange",function(l){return i.visible=l}),e.YNc(1,B,7,0,"ng-container",1),e.qZA()),2&n&&(e.Q6J("visible",i.visible)("busy",i.modalBusy)("options",e.DdM(4,J)),e.xp6(1),e.Q6J("ngIf",i.data.entityDisplayName||i.entityDisplayName))},dependencies:[p.sg,p.O5,p.PC,d.Wl,d.JJ,d.On,m.r0,m.zS,m.YM,c.fuE],styles:[".overflow-scroll[_ngcontent-%COMP%]{max-height:70vh;overflow-y:scroll}.scroll-in-modal[_ngcontent-%COMP%]{overflow:auto;max-height:calc(100vh - 15rem)}"]})}return s})();function h(s,o){const t=s.find(n=>n.name===o.parentName);if(t&&t.parentName){let n=20;return n+=h(s,t)}return t?20:0}function g(s){return s.reduce((o,t)=>[...o,...t.permissions.map(n=>({...n,groupName:t.name||""}))],[])}let D=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.oAB({type:s});static#n=this.\u0275inj=e.cJS({imports:[c.IR2,m.e2]})}return s})()}}]);